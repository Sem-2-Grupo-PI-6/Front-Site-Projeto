<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Evolvere Invest ‚Äî Login</title>

    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/login.css" />
    <link rel="icon" href="./assets/icon/favicon.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Orbitron:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <header class="site-header">
      <div class="container header-inner">
        <div class="logo">
          <a href="index.html"
            ><img src="./imgs/Logo-projeto.png" alt="Investify Logo"
          /></a>
          <div class="brand-txt">
            <h1>Evolvere Invest</h1>
            <small>Decis√µes de investimento baseadas em dados</small>
          </div>
        </div>

        <nav>
          <ul class="nav-list">
            <li><a href="index.html">In√≠cio</a></li>
            <li><a href="./cadastro.html" class="btn-link">Cadastre-se</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="auth-wrapper">
        <div class="auth-card">
          <div class="form-col">
            <h2 style="margin-bottom: 10px">Entre na sua conta</h2>
            <p style="color: var(--text); margin-bottom: 16px">
              Digite suas credenciais para acessar a plataforma.
            </p>

            <form onsubmit="return entrar()">
              <div class="form-group">
                <label for="email">E-mail</label>
                <input
                  id="input_email"
                  name="email"
                  type="email"
                  placeholder="seu@exemplo.com"
                  required
                />
                <div class="error" id="err-email">
                  Insira um e-mail v√°lido.
                </div>
              </div>

              <div class="form-group">
                <label for="senha">Senha</label>
                <input
                  id="input_senha"
                  name="senha"
                  type="password"
                  placeholder="Digite sua senha"
                  required
                />
                <div class="error" id="err-senha">
                  Senha obrigat√≥ria (m√≠nimo 8 caracteres).
                </div>
              </div>

              <div style="display: flex; justify-content: space-between; margin-top: 12px">
                <label style="display: flex; align-items: center; gap: 6px; font-size: 14px">
                  <input type="checkbox" />
                  <span>Lembrar-me</span>
                </label>
                <a href="#" class="link-small">Esqueci minha senha</a>
              </div>

              <div style="margin-top: 20px">
                <button type="submit" class="btn-primary" style="cursor: pointer">
                  Entrar
                </button>
              </div>
            </form>
          </div>

          <aside class="meta-col">
            <div class="meta-box">
              <h3 style="margin-bottom: 8px">Novo por aqui?</h3>
              <p style="color: var(--text)">
                Crie sua conta gratuita e comece a usar ferramentas anal√≠ticas
                para investimentos imobili√°rios.
              </p>
              <a class="link-small" href="./cadastro.html">Cadastre-se agora</a>
            </div>

            <div class="meta-box">
              <h4 style="margin-bottom: 8px">Acesso Demonstra√ß√£o</h4>
              <p style="color: var(--text); font-size: 13px">
                <strong>Email:</strong> demo@investimento.com<br />
                <strong>Senha:</strong> demo1234
              </p>
            </div>
          </aside>
        </div>
      </div>
    </main>

    <footer class="site-footer" style="margin-top: 40px">
      <div class="container footer-inner">
        <p>&copy; 2025 Evolvere Invest ‚Äî Prot√≥tipo educativo.</p>
        <p style="color: var(--muted)">Contato: equipe@evolvereinvest.net</p>
      </div>
    </footer>
  </body>
</html>

<script>
  function entrar() {
    const email = input_email.value.trim();
    const senha = input_senha.value.trim();

    if (!email || !senha) {
      alert("‚ö†Ô∏è Por favor, preencha todos os campos!");
      return false;
    }

    console.log('üìß Tentando login com:', email);

    fetch("/usuarios/autenticar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        emailServer: email,
        senhaServer: senha,
      }),
    })
      .then(function (resposta) {
        console.log("Status da resposta:", resposta.status);

        if (resposta.ok) {
          return resposta.json();
        } else if (resposta.status === 403) {
          throw new Error("Email ou senha inv√°lidos!");
        } else {
          throw new Error("Erro ao realizar login!");
        }
      })
      .then(function (usuario) {
        console.log('‚úÖ Login bem-sucedido!');
        console.log('üë§ Dados do usu√°rio:', usuario);

        sessionStorage.setItem('USUARIO_LOGADO', JSON.stringify(usuario));
        
        console.log('üíæ Dados salvos no sessionStorage:', sessionStorage.getItem('USUARIO_LOGADO'));


        if (usuario.email && usuario.email.includes('@admin.net')) {
          console.log('üîê Redirecionando para Dashboard Admin...');
          alert('‚úÖ Login realizado com sucesso!\n\nBem-vindo(a), Administrador(a)!');
          window.location.href = "./dashboardAdmin.html";
        } else {
          console.log('üë• Redirecionando para Dashboard Cliente...');
          alert(`‚úÖ Login realizado com sucesso!\n\nBem-vindo(a), ${usuario.nome}!`);
          window.location.href = "./dashboardCliente.html";
        }
      })
      .catch(function (erro) {
        console.error('‚ùå Erro no login:', erro);
        alert(`‚ùå ${erro.message}`);
      });

    return false;
  }
</script>